# 一、使用方法

- [参考链接](https://blog.csdn.net/qq_37616069/article/details/80376776?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165707288916781435431877%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165707288916781435431877&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-80376776-null-null.142^v31^pc_rank_34,185^v2^control&utm_term=python+request%E6%A8%A1%E5%9D%97&spm=1018.2226.3001.4187)

- 直接导入requests包即可以使用

-  get请求

  - requests.get(url)

- post 请求

  - request.post(url,data=dict)

- 不论使用那种方法还可以给通过给`headers`传入请求报文

- **获取response的方式**

  ```python
  print(response.text) # 使用response.text 时，Requests 会基于 HTTP 响应的文本编码自动解码响应内容，大多数 Unicode 字符集都能被无缝地解码
  
  print(response.content.decode('utf-8')) # 使用response.content 时，返回的是服务器响应数据的原始二进制字节流，可以用来保存图片等二进制文件,二进制解压后就是response.text
  
  
  response.json() 
  # 将响应内容转换成json格式，需要注意的是，如果返回的响应内容没有json格式则会报错
   
    # 不会报错
    def func(self):
      data = {'data': 'post'} # 可以转化成json格式
      return data
    
    def func(self)
     return post   # 报错
  ```



# 二、高效率http请求

- [gd](https://requests.readthedocs.io/en/latest/)

## 2.1 Session object

- 缓存会自动保留下来，传递到下一个请求之中

  ```python
  s = requests.Session()
  
  # cookies 被保存到 s对象之中
  s.get('https://httpbin.org/cookies/set/sessioncookie/123456789')
  # cookies 被带上
  r = s.get('https://httpbin.org/cookies') 
  
  print(r.text)
  # '{"cookies": {"sessioncookie": "123456789"}}'
  ```

- 需要注意的是，会话对象将持久化url请求自己设置的任何cookie，但如果您提供cookie作为参数，它将不会在下一次请求中持久化

  ```python
  s = requests.Session()
  
  # 自己提供的cookies 参数，将不会在下一次的请求之中
  r = s.get('https://httpbin.org/cookies', cookies={'from-my': 'browser'})
  print(r.text)
  # '{"cookies": {"from-my": "browser"}}'
  
  r = s.get('https://httpbin.org/cookies')
  print(r.text)
  # '{"cookies": {}}'
  ```

- 增强request请求

  - 增强请求效果一般需要进行如下几步

    - 复用tcp链接，减少握手消耗

    - 设置http超时、重试次数

      ```python
      # 1、定义session对象
      session = requests.Session()
      # 2、定义重试数据
          retry = Retry(
              total=retries,
              read=retries,
              connect=retries,
              backoff_factor=backoff_factor,
              status_forcelist=status_forcelist,
          )
        # 3、定义http适配器
          adapter = HTTPAdapter(max_retries=retry)
        # 4、前缀挂载
          session.mount('http://', adapter)
          session.mount('https://', adapter)
      ```

      