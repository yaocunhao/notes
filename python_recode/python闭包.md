## 一、闭包是什么

- 闭包本质就是函数的嵌套
- 闭包使用非全局变量(且不是本层的)

# 二、为什么使用闭包

- 闭包的作用就是能够保护数据的安全性以及干净性

# 三、闭包的使用场景

- 装饰器
- 保护数据的安全性

# 四、`__closure__`属性

- 闭包比普通函数多一个`__closure__`属性，该属性记录着**自由变量的地址**。当闭包被调用时，系统就会根据该地址找到对应的自由变量，完成整体函数的调用

- 自由变量

  - 当函数被销毁时，函数内部的变量也会随之被销毁
  - 而闭包函数使用的是外层函数的变量，因此python机制会判断是否为闭包函数，如果是闭包函数，则将变量提升为自由变量，也就是说该变量不会被销毁

  ```python
  def func():
      l = []
  
      def func2(num):
          l.append(num)  # l为自由变量
          print(l)
      print(func2.__closure__)
      return func2
  
  f = func()
  f(1)
  f(2)
  f(3)
  
  # 从下面结果中可以看到 l 是同一个列表
  # l 不属于全局，也不属于闭包本身，有利于保护数据的安全性
  # (<cell at 0x7fa744dd5828: list object at 0x7fa744f10dc8>,)
  # [1]
  # [1, 2]
  # [1, 2, 3]
  
  # ————————反例————————————
  
  def func():
      l = []
      def func2():
          print(a) # 使用的是全局变量
      print(func2.__closure__)
      return func2
  
  a = 1000
  f =func()
  f()
  # 从下面结果可知，没有自由变量，因此不是闭包函数,因为func2使用的是全局的变量
  # None
  # 1000
  ```

  