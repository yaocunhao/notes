[官网](http://pymotw.com/2/argparse/#simple-examples)

# 一、设置一个解析器

- 使用argparse的第一步就是创建一个解析器对象，告诉它有什么参数，当程序运行的时候，解析器就可以处理命令行参数

- **解析器类是ArgumentParser**，构造函数通过接收参数来帮助程序运行

  ```python
  import argparse
  
  parser = argparse.ArgumentParser(description="test demo") # 创建一个解析器对象
  ```

# 二、定义参数

- 不同的参数可以触发不同的动作，动作是由**add_argument()**方法的action参数指定
- 支持的动作有
  - 保存参数(单独的或者作为列表的一部分)
  - 保存一个常量值(包括bool值)
  - 统计某个参数出现的次数，以及调用一个回调函数
- 默认的动作是保存参数值，在这种情况下，有如下几点特性
  - 如果提供一个类型，那么**在存储之前会先把该参数转换成该类型**
  - 如果提供dest参数，那么将会将这个参数的值保存到Namespace对象的dest对应的属性之中(相当于起了一个别名)

# 三、解析一个命令行

- 定义了所有的参数后，可以通过给**parse_args()**传递一组参数字符串来解析命令行

  - parse_args()接收的参数是list列表

- 默认情况下，参数是从 sys.argv[1:] 中获取的(argv[0]是文件名)

- parse_args() 返回的是一个Namespace对象，这个对象的属性为传递给命令的参数。如果设置了 `dest = value`，那么可以通过args.value 来访问这个值

  ```python
  args = parse_args()
  args.value # 访问这个值
  ```

# 四、示例一

## 4.1 参数可以不通过命令行传入

```python
import argparse

parser = argparse.ArgumentParser(description='Short sample app')

parser.add_argument('-a', action="store_true", default=False) # 默认为false
parser.add_argument('-b', action="store", dest="b") 
parser.add_argument('-c', action="store", dest="c", type=int) #类型为int，在存储之前会进行转换

# 以list的方式传入
# 选项和参数之间可以带空格，可以不带空格，也可以使用=号
# -a 选择有的话就是true，没有就是 false

print (parser.parse_args(['-a', '-bval', '-c', '3'])) # Namespace(a=True, b='val', c=3)
print (parser.parse_args(['-bval', '-c', '3'])) # Namespace(a=False, b='val', c=3)
print (parser.parse_args(['-bval', '-c=311'])) # Namespace(a=False, b='val', c=311)
```

## 4.2 必选参数

- 当参数选项前面没有`-`之时为必选参数

```python
# 必选参数
import argparse

parser = argparse.ArgumentParser(description='Example with non-optional arguments')

parser.add_argument('count', action="store", type=int)
parser.add_argument('units', action="store")

print (parser.parse_args()) # main.py: error: the following arguments are required: count, units
```

# 五、action 参数选项

- store

  - 默认操作，将参数转换成对应的类型后，存储起来

    ```python
    parser.add_argument('-s', action='store', dest='simple_value',
                        help='Store a simple value')
    print ('simple_value     =', results.simple_value)
    
    # python main.py -s value
    # simple_value     = value
    ```

- store_const

  - 保存的不是来自命令行的值，而是参数说明的值

  ```python
  parser.add_argument('-c', action='store_const', dest='constant_value',
                      const='value-to-store',
                      help='Store a constant value')
  print ('constant_value   =', results.constant_value)
  
  # python main.py -c
  # constant_value   = value-to-store
  ```

- store_true/store_false

  - 保存对应的bool值，用来实现开关

  - 带选项就是设定的值

    ```python
    parser.add_argument('-t', action='store_true', default=False,
                        dest='boolean_switch',
                        help='Set a switch to true')
    
    parser.add_argument('-f', action='store_false', default=False,
                        dest='boolean_switch',
                        help='Set a switch to false')
    # python main.py -t
    # boolean_switch   = True
    
    python main.py -f
    boolean_switch   = False
    
    ```

- append

  - 将参数保存在list之中，如果重复则保存多个

    ```python
    parser.add_argument('-a', action='append', dest='collection',
                        default=[],
                        help='Add repeated values to a list',
                        )
    
    # python main -a one -a two -a there
    # collection       = ['one', 'two', 'there']
    ```

    

- append_const

  - 将参数说明中定义的值保存到列表中

    ```python
    parser.add_argument('-A', action='append_const', dest='const_collection',
                        const='value-1-to-append',
                        default=[],
                        help='Add different values to list')
    
    parser.add_argument('-B', action='append_const', dest='const_collection',
                        const='value-2-to-append',
                        help='Add different values to list')
    
    # python main.py -B -A
    # const_collection = ['value-2-to-append', 'value-1-to-append']
    ```

    

- version

  -  打印程序的版本详细信息，然后退出

    ```python
    parser.add_argument('--version', action='version', version='%(prog)s 1.0')
    
    #  python main.py --version
    # main.py 1.0
    ```

    

- 