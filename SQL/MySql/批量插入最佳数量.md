- [link](https://blog.csdn.net/qq_32062699/article/details/128935013?ops_request_misc=&request_id=&biz_id=102&utm_term=mysql%20%E4%B8%80%E6%AC%A1%E6%80%A7%E6%8F%92%E5%85%A5%E5%A4%9A%E5%B0%91%E6%9D%A1%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E6%AF%94%E8%BE%83%E9%AB%98&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-128935013.142^v96^pc_search_result_base3&spm=1018.2226.3001.4187)
  - 选择合适的值
    - 作者极限值64W条数据
    - 测试得到结论：最佳大小是max_allowed_packet的一半，也就是极限能插入64W，选用32W也许性能会更好一些，同时也不会对mysql的其他操作产生太大的影响。 



- 在任意数据库下进行查看一次性允许传递的最大数据

  ```mysql
  mysql> show variables like 'slave_max_allowed_packet';
  +--------------------------+------------+
  | Variable_name            | Value      |
  +--------------------------+------------+
  | slave_max_allowed_packet | 1073741824 | 字节 == 1024M
  +--------------------------+------------+
  
  
  # my.ini里面有max_allowed_packet这个参数控制通信的packet大小。
  # mysql5.7的客户端默认是16M，服务端的限制是4M
  # 官方解释是适当增大max_allowed_packet参数可以是client端到server端传递大数据时，系统能够分配更多的扩展内存来处理
  mysql> show variables like 'max_allowed_packet';
  +--------------------+---------+
  | Variable_name      | Value   |
  +--------------------+---------+
  | max_allowed_packet | 4194304 | 字节 == 4M
  +--------------------+---------+
  ```

  计算一次性能最大插入的数据

  ```mysql
  # 假设有字段如下
  	字段1 int(10)
  	字段2 int(10)
  	字段3 int(10)
  	字段4 varchar(10)
  	
  # 一条数据的大小： 3*4B + 10*4(假设全都是中文，占4字节) = 52B
  # 因此允许一次性插入的数据极限大小为 ： 4194304//52=80659 万条
  ```

- 在做插入操作时的整体时间分配

  ```tex
  链接耗时 （30%）
  发送query到服务器 （20%）
  解析query （20%）
  插入操作 （10% * 词条数目）
  插入index （10% * Index的数目）
  关闭链接 （10%）
  
  从这里可以看出来，真正耗时的不是操作，而是链接，解析的过程。单条sql的话，会在链接，解析部分耗费大量的时间，因此速度会很慢，所以我们一般都是采用批量插入的操作，争取在一次链接里面写入尽可能多的数据，以此来提升插入的速度。
  但是这个尽可能多的数据是多少呢？一次到底插入多少才合适呢？
  
  ```

- 事务大小

  ```mysql
  # 事务需要控制大小，事务太大可能会影响执行的效率。MySQL有innodb_log_buffer_size配置项，超过这个值会把innodb的数据刷到磁盘中，这时，效率会有所下降。所以比较好的做法是，在数据达到这个这个值前进行事务提交
  
  mysql> show variables like 'innodb_log_buffer_size';
  +------------------------+----------+
  | Variable_name          | Value    |
  +------------------------+----------+
  | innodb_log_buffer_size | 16777216 |
  +------------------------+----------+
  
  # 该值远大于允许传递的最大数据
  ```

  