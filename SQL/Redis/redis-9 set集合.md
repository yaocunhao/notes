# 一、基本概念

## 1.1 定义

- set 元素是无序的
- 集合中的每一个成员，都是字符串类型，**并且不可重复,也就是自动去重的** 
- set是通过哈希映射实现的，所以增删查改操作都是O(1)
- 和其他数据类型一样，当集合中最后一个成员被删除时，存储成员所用的数据结构也会被自动删除

## 1.2 底层结构

- 当 set 存储的数据满足以下要求时，使用 intset 结构

  - 集合内保存的所有成员都是整数值

  - 集合内保存的成员数量不超过 512 个

  - intset结构如下

    ```c++
    typedf struct inset{
        uint32_t encoding;//指定编码方式，默认为INSET_ENC_INT16
        uint32_t length;//集合内成员的总个数
        int8_t contents[];//实际存储成员的数组，并且数组中的数值从小到大依次排列
    }inset;
    ```

- 当不满足上述条件时，采用的是hash结构



# 二、set 命令

- 添加、删除

  | sadd key [v1,v2...] | 向集合中添加一个或者多个元素，并且自动去重。   |
  | ------------------- | ---------------------------------------------- |
  | srem key v1,v2      | 删除一个或者多个元素，若元素不存在则自动忽略。 |

- 查看

  | sismenber key member | 查看指定元素是否存在于集合中。 |
  | -------------------- | ------------------------------ |
  | smembers key         | 查看集合中所有元素。           |

- 求差集

  | sdiff key1 key2                  | 求两个或多个集合的差集。                                 |
  | -------------------------------- | -------------------------------------------------------- |
  | sdiffstore destination key1 key2 | 求两个集合或多个集合的差集，并将结果保存到指定的集合中。 |

- 求交集

  | sinter key1 key2                  | 求两个或多个集合的交集。                             |
  | --------------------------------- | ---------------------------------------------------- |
  | sinterstore destination key1 key2 | 求两个或多个集合的交集，并将结果保存到指定的集合中。 |

- 求并集

  | sunion key1 key2                  | 求两个或者多个集合的并集。                             |
  | --------------------------------- | ------------------------------------------------------ |
  | sunionstore destination key1 key2 | 求两个或者多个集合的并集，并将结果保存到指定的集合中。 |

- 其它

  | scard key                                      | 返回集合中元素的个数。                         |
  | ---------------------------------------------- | ---------------------------------------------- |
  | smove key_source key_destination member        | 将集合中的元素移动到指定的集合中。             |
  | spop key count                                 | 弹出指定数量的元素。                           |
  | srandmember key  count                         | 随机从集合中返回指定数量的元素，默认返回 1个。 |
  | sscan key cursor [match pattern] [count count] | 该命令用来迭代的集合中的元素。                 |

