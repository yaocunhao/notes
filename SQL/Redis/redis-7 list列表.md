# 一、基本概念

## 1.1 操作流程

- 指定key

- 从列表的左侧(头部)，或者右侧(尾部)来添加元素，元素会以添加时的顺序排列
- 一个列表最多包含2^32 - 1 个元素
- 当列表最后一个元素弹出时，该结构会被自动删除

## 1.2 底层结构

- Redis list 相当于链表结构，插入删除时间复杂度为O(1),查询的时间复杂度为O(n),**底层其实是一种被称为快速列表的结构**

- 压缩列表ziplist
  - 当列表中存储的元素较少时，Redis 会使用一块连续的内存来存储这些元素，这个连续的结构被称为 ziplist（压缩列表），它将所有的元素紧挨着一起存储
  - 压缩列表是 Redis 为节省内存而开发的，它是由一系列特殊编码的连续内存块组成的顺序型数据结构，一个压缩列表了可以包含任意多个节点，每个节点都可以保存一个字符数组或者整数值

- 快速链表quicklist
  - 当数据量较大时，Redis 列表就会是用 quicklist（快速链表）存储元素
  - Redis 之所以采用两种方法相结合的方式来存储元素。这是因为单独使用普通链表存储元素时，所需的空间较大，会造成存储空间的浪费。因此采用了链表和压缩列表相结合的方式，也就是 quicklist + ziplist，结构如下图![image-20220619231101172](https://yrecord.oss-cn-hangzhou.aliyuncs.com/picture/202206192311230.png)
    - 将多个压缩列表用双向指针连接起来，既满足快速插入和删除的特性，又节省了一部分存储空间

# 二、list命令

## 2.1 常用命令

- 插入

  | lpush key v1,v2 | 在列表头部插入一个或者多个值                      |
  | --------------- | ------------------------------------------------- |
  | rpush key v1,v2 | 在列表尾部添加一个或多个值                        |
  | lpushx key v    | 当储存列表的 key 存在时，用于将值插入到列表头部   |
  | rpushx key v    | 当存储列表的 key 存在时，用于将值插入到列表的尾部 |

- 弹出

  | lpop key                | 从列表的头部弹出元素，默认为第一个元素                       |
  | ----------------------- | ------------------------------------------------------------ |
  | rpop key                | 从列表的尾部弹出元素，默认为最后一个元素                     |
  | blpop key1 key2 timeout | 用于删除并返回列表中的第一个元素（头部操作），如果列表中没有元素，就会发生阻塞， 直到列表等待超时或发现可弹出元素为止 |
  | brpop key1 key2 timeout | 用于删除并返回列表中的最后一个元素（尾部操作），如果列表中没有元素，就会发生阻塞， 直到列表等待超时或发现可弹出元素为止 |

- 读取

  | lrange key start stop | 获取列表指定范围内的元素 |
  | --------------------- | ------------------------ |
  | lindex key index      | 通过索引获取列表中的元素 |

- 插入

  | rpoplpush source destination          | 用于删除列表中的最后一个元素，然后将该元素添加到另一个列表的头部，并返回该元素值 |
  | ------------------------------------- | ------------------------------------------------------------ |
  | brpoplpush source destination timeout | 从列表中取出最后一个元素，并插入到另一个列表的头部。如果列表中没有元素，就会发生 阻塞，直到等待超时或发现可弹出元素时为止 |

- 索引操作

  | lset key index  value                | 表示通过其索引设置列表中元素的值                             |
  | ------------------------------------ | ------------------------------------------------------------ |
  | linsert key before/after pivot value | 指定列表中一个元素在它之前或之后插入另外一个元素             |
  | lrem key count value                 | 表示从列表中删除元素与 value 相等的元素。count 表示删除的数量，为 0 表示全部移除 |
  | ltrim key start stop                 | 保留范围内的元素                                             |

- 获取长度

  | llen key | 用于获取列表的长度 |
  | -------- | ------------------ |



# 三、运用

- 左进右出：栈模型
- 右进右出：队列模型
- 用作异步队列

