# 一、key是什么

- Redis 是一种键值（key-value）型的缓存型数据库，它将数据全部以键值对的形式存储在内存中，并且 key 与 value 一一对应。这里的 key 被形象的称之为密钥，Redis 提供了诸多操作这把“密钥”的命令，从而实现了对存储数据的管理

# 二、key的特点

## 2.1 key对应值的类型

- key 的类型对应着 value 的类型，同样也有五种（string、list、hash、set、zset）。如果 key 指向的是一个字符串类型的值，那么 key 的类型就是字符串。我们可以通过`TYPE`命令来查看 key 对应的类型

  ```python
  # 字符串
  127.0.0.1:6379> set kstring v1
  OK
  127.0.0.1:6379> type kstring
  string
  
  # 列表
  127.0.0.1:6379> lpush klist v2
  [6~(integer) 1
  127.0.0.1:6379> type klist
  list
  
  # 集合
  127.0.0.1:6379> sadd kset v1 v2 v3
  (integer) 3
  127.0.0.1:6379> type kset
  set
  ```

  

##  2.2 key的使用规范

- key 的命名需要遵循以下规则：
  - key 取值不可以太长，否则会影响 value 的查找效率，并且浪费内存空间
  - key 取值也不能过短，否则会使得 key 可读性变差
- 可以将空字符设置成key
- 对于相同的数据，如果对已经存在的数据重新设置了value,那么原来的value就会被覆盖。**可以采用这种方法来对值进行修改**

## 2.3 key的过期时间

- Redis 允许你为 key 设置一个过期时间（使用 EXPIRE 等命令），也就是“到点自动删除”，主要有两点作用
  - 它可以避免使用频率不高的 key 长期存在，从而占用内存资源
  - 控制缓存的失效时间
- Redis 会把每个设置了过期时间的 key 存放到一个独立的字典中，并且会定时遍历这个字典来删除到期的 key。除了定时遍历之外，它还会使用“惰性策略”来删除过期的 key。所谓“惰性策略”指的是当客户端访问这个 key 的时候，Redis 对 key 的过期时间进行检查，如果过期了就立即删除。Redis 使用两种方式相结合的方法来处理过去的 key



# 三、操作key命令格式

## 3.1 语法规范

- 语法为`command key`

  ```python
  127.0.0.1:6379> set kk v1
  OK
  127.0.0.1:6379> get kk
  "v1"
  
  127.0.0.1:6379> del kk #删除key
  (integer) 1
  
  127.0.0.1:6379> get kk
  (nil)
  ```

## 3.2 key操作命令汇总

| 命令                | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| del key             | 若键存在的情况下，该命令用于删除键。                         |
| dump key            | 用于序列化给定 key ，并返回被序列化的值。                    |
| exists key          | 用于检查键是否存在，若存在则返回 1，否则返回 0。             |
| expire key          | 设置 key 的过期时间，以秒为单位。                            |
| EXPIREAT key]       | 该命令与 EXPIRE 相似，用于为 key 设置过期时间，不同在于，它的时间参数值采用的是时间戳格式。 |
| PEXPIRE key         | 设置 key 的过期，以毫秒为单位。                              |
| PEXPIREAT key       | 与 PEXPIRE 相似，用于为 key 设置过期时间，采用以毫秒为单位的时间戳格式。 |
| KEYS pattern        | 此命令用于查找指定模式的键,**key*返回数据库之中所有的键**    |
| MOVE key db         | 将当前数据库中的 key 移动至指定的数据库中（默认存储为 0 库，可选 1-15中的任意库）。 |
| PERSIST key         | 该命令用于删除 key 的过期时间，然后 key 将一直存在，不会过期。 |
| PTTL key            | 用于检查 key 还剩多长时间过期，以毫秒为单位。                |
| TTL key             | 用于检查 key 还剩多长时间过期，以秒为单位。                  |
| RANDOMKEY           | 从当前数据库中随机返回一个 key。                             |
| RENAME key newkey   | 修改 key 的名称。                                            |
| RENAMENX key newkey | 如果新键名不重复，则将 key 修改为 newkey。                   |
| SCAN cursor         | 基于游标的迭代器，用于迭代数据库中存在的所有键，cursor 指的是迭代游标。 |
| TYPE key            | 该命令用于获取 value 的数据类型。                            |

## 3.3 命令解释

- keys

  ```python
  # 获取所有的键
  127.0.0.1:6379> keys *
   1) "k"
   2) "sk2"
   3) "klist"
   4) "zk"
   5) "k1"
   6) "sk"
   7) "kk"
   8) "foo"
    
  127.0.0.1:6379> keys k*
  1) "k"
  2) "klist"
  3) "k1"
  4) "kk"
  5) "kstring"
  6) "kset"
  7) "k3"
  8) "k2"
  ```

  

- scan cursor 

  - SCAN 命令是一个基于游标的迭代器，每次被调用之后， 都会向用户返回一个新的游标， **用户在下次迭代时需要使用这个新游标作为 SCAN 命令的游标参数， 否则将无法继续跌代**。如果新游标**返回 0 则表示迭代结束**

  - SCAN 令可以迭代数据库中的所有键，如果想针对特定的数据类型迭代，那么命令自然也要做相应的变化。如下所示：

    - SSCAN 命令用于迭代集合键中的元素。
    - HSCAN 命令用于迭代哈希键中的键值对。
    - ZSCAN 命令用于迭代有序集合中的元素

    ```python
    127.0.0.1:6379> scan 0
    1) "5"								# 返回新的游标
    2)  1) "k"
        2) "hkey"
        3) "kstring"
        4) "k3"
        5) "k2"
        6) "zk"
        7) "kk"
        8) "kset"
        9) "k1"
       10) "1"
      
    127.0.0.1:6379> scan 5 # 继续迭代
    1) "0"								# 迭代结束
    2) 1) "runoob"
       2) "sk2"
       3) "klist"
       4) "sk"
       5) "setk"
       6) "foo"
    ```

- TTL命令

  - 在 key 设置过期时间的情况下，使用该命令检查 key 剩余的过期时间
  - 当键没有设置过期时间，表示是永久有效时，TTL 命令返回 -1；当键过期或者被删除时，TTL 命令返回 -2

- 清空数据
  - flushall

- 所有的键的数量
  - dbsize