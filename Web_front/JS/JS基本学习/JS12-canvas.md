# 一、画布的缩放

## 1.1 画布的缩放参数：`ctx.setTransform`

- `setTransform()` 方法接受六个参数，这些参数定义了一个变换矩阵，可以进行缩放、旋转和平移操作：

  - **a (scaleX)**: 水平缩放绘图。

  - **b (skewY)**: 水平倾斜绘图。

  - **c (skewX)**: 垂直倾斜绘图。

  - **d (scaleY)**: 垂直缩放绘图。

  - **e (translateX)**: 水平移动绘图。

  - **f (translateY)**: 垂直移动绘图。

    ```js
    const canvas = document.getElementById("myCanvas");
    const ctx = canvas.getContext("2d");
    
    // 先清除任何之前的变换， 通过修改下述参数查看效果
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    
    // 绘制一个矩形来展示变换效果
    ctx.fillStyle = "red";
    ctx.fillRect(0, 0, 100, 50);
    
    
    // 绘制一个矩形来展示变换效果
    ctx.fillStyle = "red";
    ctx.fillRect(0, 0, 100, 50);
    ```

## 2.2 画布缩放原理

在 HTML5 Canvas 上进行缩放时，涉及到变换矩阵的使用，这对图像的显示坐标以及如何在缩放后处理图像坐标有重要影响。下面我会解释缩放原理以及它如何改变坐标系统。

### 缩放原理

Canvas 2D API 允许开发者通过修改变换矩阵来控制画布的缩放、旋转和平移。变换矩阵是一个3x3的矩阵，但在API中我们通常只操作其六个值，因为第三行默认为 `[0, 0, 1]`。当涉及缩放时，主要调整矩阵的前四个值：

```
复制代码[ a, b, c, d, e, f ]
```

其中 `a` 和 `d` 分别代表 x 轴和 y 轴的缩放因子。默认情况下，这个矩阵是单位矩阵 `[1, 0, 0, 1, 0, 0]`。

### 坐标变化

当在 Canvas 上应用缩放时：

- **缩放操作**：通过调整 `a` 和 `d` 的值，你可以使图像沿 x 轴和 y 轴放大或缩小。例如，`a = 2` 和 `d = 2` 会使图像宽度和高度扩大两倍。
- **坐标变化**：缩放改变了坐标系的“尺度”，<font color=yellow>**这意味着同一个物理位置在屏幕上的像素点会映射到一个新的逻辑坐标。如果你在不移动画布原点的情况下放大画布，画布上的点 `(x, y)` 会被重新映射到 `(x * a, y * d)`**</font>

### 平移以中心缩放

通常，**仅仅缩放会导致图像以画布的原点（通常是左上角）为中心进行缩放**，这可能不是我们希望的效果。为了让缩放以鼠标位置或画布中心为中心：

1. **计算鼠标位置与原点的偏移**：找出鼠标点 `(mx, my)` 相对于原点的位置。
2. **应用缩放**：改变矩阵的 `a` 和 `d` 值来进行缩放。
3. **计算新位置**：新的坐标将是 `(mx * a, my * d)`。
4. **调整平移量**：为了保持鼠标下内容的视觉不变，需要计算并应用相应的平移量。这通常通过设置矩阵的 `e` 和 `f` 值来完成，以确保鼠标位置在视觉上保持静止。

这种处理方式确保了缩放操作不仅仅是简单的放大或缩小，而是能够更加精细地控制图像的显示方式，提升用户的交互体验。

```js
计算逻辑坐标：使用 canvas.width / rect.width 和 canvas.height / rect.height 计算鼠标在画布上的逻辑坐标，确保缩放与鼠标的位置匹配。
缩放因子：zoomFactor 根据鼠标滚轮方向调整，使缩放可以根据鼠标滚轮上滚（放大）或下滚（缩小）进行调整。
更新平移量：为了确保缩放以鼠标为中心，平移量需要根据新的缩放比例进行更新。计算方法是，先按照新的缩放因子调整当前平移量，再加上基于缩放因子和鼠标位置调整的额外平移。
应用变换：使用 ctx.setTransform() 方法将新的缩放比例和平移量应用到画布上。
```

# 二、画布的挪动

- [translate](https://juejin.cn/post/7198767799484563516?searchId=2024041511544539AE621E979292808BC8)

# 三、画布填充

- ctx.fillStyle 填充画布样式或者颜色
- `ctx.fillRect(x, y, width, height)` 方法用于在画布上绘制一个填充矩形。此方法接受四个参数：
  - **x**：矩形左上角的 x 坐标。
  - **y**：矩形左上角的 y 坐标。
  - **width**：矩形的宽度。
  - **height**：矩形的高度。绘制的矩形将使用当前设置的 `ctx.fillStyle` 属性定义的颜色或样式进行填充。

# 四、一些坐标点

- **`clientX` 和 `clientY`**
  - 鼠标相对于视窗的坐标
- offsetX、offsetY
  - 鼠标相对于 canvas 边界的坐标
- 视窗（屏幕显示区域）坐标转换为逻辑坐标
