#  一、如何进行文件上传

[文件上传](https://blog.csdn.net/sinat_17775997/article/details/123138383?ops_request_misc=&request_id=&biz_id=102&utm_term=%E5%89%8D%E7%AB%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-123138383.142^v96^pc_search_result_base8&spm=1018.2226.3001.4187)

- [什么是FormData](https://blog.csdn.net/cake_eat/article/details/109235197?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170264585216800182720957%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170264585216800182720957&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-109235197-null-null.142^v96^pc_search_result_base8&utm_term=FormData%20%E6%98%AF%E4%BB%80%E4%B9%88&spm=1018.2226.3001.4187)
- [JS XMLHttpRequest对象详解](https://blog.csdn.net/weixin_52148548/article/details/124668864?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170264591016800192268047%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170264591016800192268047&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-124668864-null-null.142^v96^pc_search_result_base8&utm_term=XMLHttpRequest&spm=1018.2226.3001.4187)
- [FormData 参考链接](https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/values)

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  input {
    height: 300px;
    width: 300px;
  }
</style>

<body>

  <input type="file" id="file">
  <button id="upload"> 上传</button>

</body>
<script>
  function upload_file() {
    file = document.getElementById("file").files[0]
    let formData = new FormData();
    formData.append('file', file)
    // 遍历查看
    // for (var value of formData.values()) {
    //   console.log(value);
    // }
    fetch("http://127.0.0.1:6001/test43/", {
      method: 'post',
      body: formData,
      // 不能设置，否则会导致错误
      // headers:{
      //   'Content-Type':'multipart/form-data'
      // }
    }).then(
      res => {
        console.log("上传成功!!")
      },
      err => {
        console.log("上传失败!!")
      }
    )
  }
  b = document.getElementById("upload")
  b.addEventListener('click', upload_file)
</script>

</html>
```

# 二、文件加载

- 获取文件流、转换成`Blob`对象、创建a标签、模拟a标签点击动作，然后加载文件
- [link](https://zhuanlan.zhihu.com/p/502721718)

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  input {
    height: 300px;
    width: 300px;
  }
</style>

<body>

  <button id="download"> 加载</button>

</body>
<script>
  const download = (res, type, filename) => {
    // 创建blob对象，解析流数据
    const blob = new Blob([res], {
      // 设置返回的文件类型
      type: type
    })
    // 这里就是创建一个a标签，等下用来模拟点击事件
    const a = document.createElement('a')
    // 兼容webkix浏览器，处理webkit浏览器中href自动添加blob前缀，默认在浏览器打开而不是下载
    const URL = window.URL || window.webkitURL
    // 根据解析后的blob对象创建URL 对象
    const herf = URL.createObjectURL(blob)
    // 下载链接
    a.href = herf
    // 下载文件名,如果后端没有返回，可以自己写a.download = '文件.pdf'
    a.download = filename
    document.body.appendChild(a)
    // 点击a标签，进行下载 
    a.click()
    // 收尾工作，在内存中移除URL 对象
    document.body.removeChild(a)
    window.URL.revokeObjectURL(herf)
  }

  function download_file() {
    fetch('http://127.0.0.1:6001/test12/').then(
      resp => {
        console.log("Sucess")
        resp.blob().then(
          d => {
            download(d, 'application/text;charset=UTF-8', 't.text')
          }
        )
      }
    )
  }

  b = document.getElementById("download")
  b.addEventListener('click', download_file)
</script>

</html>
```

